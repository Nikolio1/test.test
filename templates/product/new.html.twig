{% extends 'base.html.twig' %}


{% block body %}

    {{ form_start(form) }}
    <div class="form-control">
        {{ form_label(form.name,'Product name') }}
        <div class="form-error">
            {{ form_errors(form.name) }}
        </div>
        {{ form_widget(form.name) }}
        <small>{{ form_help(form.name) }}</small>

    </div>

    <div class="form-control">
        {{ form_label(form.color,'Product color') }}
        <div class="form-error">
            {{ form_errors(form.color) }}
        </div>
        {{ form_widget(form.color) }}
        <small>{{ form_help(form.color) }}</small>

    </div>

    <div class="form-control">
        {{ form_label(form.price) }}
        <div class="form-error">
            {{ form_errors(form.price) }}
        </div>
        {{ form_widget(form.price) }}
        <small>{{ form_help(form.price) }}</small>

    </div>
    <div class="form-control">
        {{ form_label(form.createDat) }}
        {{ form_widget(form.createDat) }}
        <small>{{ form_help(form.createDat) }}</small>
        <div class="form-error">
            {{ form_errors(form.createDat) }}
        </div>
    </div>

    <button type="submit" >Save</button>

    <ul class="suppliers" data-prototype="{{ form_widget(form.suppliers.vars.prototype)|e('html_attr') }}">

    </ul>

    {{ form_end(form) }}
    <a href="{{ path('products') }}">Products</a>

{% endblock body %}

{% block javascripts %}

    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <script>
        var $collectionHolder;
        // setup an "add a tag" link
        var $addSupplierButton = $('<button type="button" class="add_supplier_link">Add a supplier</button>');
        var $newLinkLi = $('<li></li>').append($addSupplierButton);

        jQuery(document).ready(function() {
            $collectionHolder = $('ul.suppliers');

            $collectionHolder.append($newLinkLi);

            $collectionHolder.data('index', $collectionHolder.find(':input').length);

            $addSupplierButton.on('click', function(e) {
                addSupplierForm($collectionHolder, $newLinkLi);
            });
        });

        function addSupplierForm($collectionHolder, $newLinkLi) {
            // Get the data-prototype explained earlier
            var prototype = $collectionHolder.data('prototype');

            // get the new index
            var index = $collectionHolder.data('index');

            var newForm = prototype.replace(/__name__/g, index);

            $collectionHolder.data('index', index + 1);


            var $newFormLi = $('<li></li>').append(newForm);
            $newLinkLi.before($newFormLi);

            $newFormLi.append('<button class="remove-supplier"  type="button">Delete this supplier</button>');

            $newLinkLi.before($newFormLi);

            // handle the removal, just for this example
            $('.remove-supplier').click(function(e) {
                e.preventDefault();

                $(this).parent().remove();

                return false;
            });

            // jQuery(document).ready(function() {
            //
            //     $collectionHolder = $('ul.suppliers');
            //
            //
            //     $collectionHolder.find('li').each(function() {
            //         addSupplierFormDeleteLink($(this));
            //     });
            //
            //
            // });

            // function addSupplierForm() {
            //     addSupplierFormDeleteLink($newFormLi);
            // }
            //
            // function addSupplierFormDeleteLink($supplierFormLi) {
            //     var $removeFormButton = $('<button type="button">Delete this supplier</button>');
            //     $supplierFormLi.append($removeFormButton);
            //
            //     $removeFormButton.on('click', function(e) {
            //
            //         $supplierFormLi.remove();
            //     });
            // }
        }
    </script>
{% endblock %}